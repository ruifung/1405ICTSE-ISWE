<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/iron-image/iron-image.html">
<link rel="import" href="/bower_components/neon-animation/neon-animation.html">
<link rel="import" href="/bower_components/iron-location/iron-location.html">
<link rel="import" href="/bower_components/carbon-route/carbon-location.html">
<link rel="import" href="/bower_components/carbon-route/carbon-route.html">

<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/styles/global-styles.html">

<dom-module id="iswe-root">
    <template>
        <style include="iron-flex"></style>
        <style include="global-styles">
            :host {
                height: 100vh
            }
            
            #header > * {
                color: black;
            }
            
            #header {
                --paper-toolbar-background: #eee;
            }
            
            #header > paper-tabs {
                height: 100%;
                --paper-tabs-selection-bar-color: transparent;
            }
            
            #header > paper-tabs > * {
                transition: background-color 0.2s linear;
            }
            
            #header > paper-tabs > .iron-selected {
                background-color: black;
                color: white;
            }
            
            .contentBody {
                height: calc(100vh - 64px);
                width: 100%;
                overflow: auto;
            }
        </style>
        <iron-location hash="{{hash}}"></iron-location>
        <carbon-location route="{{route}}"></carbon-location>
        <carbon-route route="{{route}}" pattern="/:page" data="{{routedata}}" tail="{{subroute1}}"></carbon-route>
        <paper-header-panel class="flex" mode="waterfall">
            <paper-toolbar id="header">
                <div>
                    <a href="/"><h2 style="padding-right: 5px;">Northern Fame Books</h2></a>
                </div>
                <paper-tabs attr-for-selected="page" selected="{{routedata.page}}">
                    <template is="dom-repeat" items="{{pages}}">
                        <paper-tab page$="[[item.page]]">[[item.title]]</paper-tab>
                    </template>
                </paper-tabs>
            </paper-toolbar>
            
            <neon-animated-pages id="pageSwitcher" class="contentBody flex layout vertical" 
                                 attr-for-selected="page" selected="[[routedata.page]]"
                                 entry-animation="slide-from-top-animation" exit-animation="fade-out-animation">
            </neon-animated-pages>
        </paper-header-panel>
    </template>
    <script>
        Polymer({
            is: "iswe-root",
            ready: function() {
                this.title = "TEST TITLE";
                this.pages = [
                    {
                        title: 'Home',
                        path: 'home-page.html',
                        tag: 'home-page',
                        page: "",
                        attributes: []
                    },
                    {
                        title: 'TEST2',
                        page: 'test'
                    },
                    {
                        title: 'TEST3',
                        page: 'test1',
                    },
                    {
                        title: 'TEST4',
                        page: 'test2',
                    },
                    {
                        title: 'TEST5',
                        page: 'test3',
                    },
                ];
                //Setup page definitions
                for (var i = 0; i < this.pages.length; i++) {
                    var pageObj = this.pages[i];
                    var pagesDom = Polymer.dom(this.$.pageSwitcher);
                    if (typeof pageObj.tag === "string") {
                        var elem = document.createElement(pageObj.tag);
                        var elemDom = Polymer.dom(elem);
                        elemDom.setAttribute('page', pageObj.page);
                        if (Array.isArray(pageObj.attributes))
                            for (var j = 0; j < pageObj.attributes.length; j++) {
                                var attrObj = pageObj.attributes[j]
                                elemDom.setAttribute(attrObj.key,attrObj.value);
                            }
                        pagesDom.appendChild(elem);
                    }
                    if (typeof pageObj.path === "string")
                        this.importHref(this.resolveUrl(pageObj.path), null, null, true);
                }
            },
            properties: {
                selected: {
                    type: String,
                },
                
                data: {
                    type: Object,
                    observer: "_printVal"
                }
            },
            
            _selectedTabChanged: function(nv, ov) {
                console.info(nv)
            },
            
            _printVal: function(nv, ov) {
                console.log(nv);
            }
        });
    </script>
</dom-module>